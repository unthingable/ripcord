name: Release
on:
  push:
    tags: ['v*']
jobs:
  release:
    runs-on: macos-15
    steps:
      - uses: actions/checkout@v4
      - run: swift build -c release
      - name: Create unsigned app bundle
        run: |
          BIN_PATH=$(swift build -c release --show-bin-path)
          mkdir -p Ripcord.app/Contents/MacOS Ripcord.app/Contents/Resources
          cp $BIN_PATH/Ripcord Ripcord.app/Contents/MacOS/Ripcord
          cp $BIN_PATH/transcribe Ripcord.app/Contents/MacOS/transcribe
          cp Info.plist Ripcord.app/Contents/Info.plist
      - name: Zip bundle
        run: zip -r ripcord-${{ github.ref_name }}.zip Ripcord.app/
      - name: Create release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: gh release create ${{ github.ref_name }} ripcord-${{ github.ref_name }}.zip --generate-notes
